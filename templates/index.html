{% load static %}

<html>
<head>
<script src="{% get_static_prefix %}js/jquery-3.2.0.min.js"></script>
<script type="text/javascript" src="{% get_static_prefix %}js/ws4redis.js"></script>

<script>

    jQuery(document).ready(function($) {
    var ws4redis = WS4Redis({
{#        uri: '{{ WEBSOCKET_URL }}foobar?subscribe-broadcast&publish-broadcast&echo',#}
{#        uri: 'ws://' + location.hostname + ':' + location.port + '/ws/foobar?subscribe-broadcast&publish-broadcast&echo',#}
        uri: 'ws://' + location.hostname + ':' + location.port + '/ws/foobar?subscribe-broadcast&publish-broadcast',
        connecting: on_connecting,
        connected: on_connected,
        receive_message: receiveMessage,
        disconnected: on_disconnected,
{#        heartbeat_msg: {{ WS4REDIS_HEARTBEAT }},#}
{#        heartbeat_msg: 'WS4REDIS_HEARTBEAT',#}
    });

    // attach this function to an event handler on your site
    function sendMessage() {
        ws4redis.send_message('A message');
    }

    function on_connecting() {
        document.writeln('Websocket is connecting...</br>');
    }

    function on_connected() {
        ws4redis.send_message('Hello');
    }

    function on_disconnected(evt) {
        document.writeln('Websocket was disconnected: ' + JSON.stringify(evt) + '</br>');
    }

    // receive a message though the websocket from the server
    function receiveMessage(msg) {
        if (msg == 'ws4redis_heartbeat'){
            return
        };
        document.writeln('Message from Websocket: ' + msg  + '</br>');
    }
});

</script>

    </head>

</html>